<script class="mobify" id="mobify-tag">
(function(window, document, libraryUrl, mainUrl, detector) {

// If Mobify has been defined already, or if the detector fails,
// exit
if (this.Mobify || !detector()) {
    return;
}

// Start Mobify object with initial timestamp when loaded
window.Mobify = {points: [+new Date]};

function attachScriptBeforeMobifyTag(src, id, classNames) {
    var attachedScript = document.createElement('script');
    var mobifyTagScript = document.getElementById('mobify-tag');

    attachedScript.src = src;
    attachedScript.id = id;
    attachedScript.setAttribute("class", classNames);
    mobifyTagScript.parentNode.insertBefore(attachedScript, mobifyTagScript);
    return attachedScript;
}

// Prevent the browser from downloading website resources
document.write('<plaintext style="display:none">');

// On next tick, load library and main executable
setTimeout(function() {
    window.capturing = true;
    var libraryScript = attachScriptBeforeMobifyTag(libraryUrl, "mobify-js-library", "mobify");
    libraryScript.onload = function(){
        attachScriptBeforeMobifyTag(mainUrl, "mobify-js-main", "mobify");
        // TODO: If main fails to load, load capture.restore
    };

});

})( window, document,
    // path to library
    'http://localhost:3000/build/mobify-2.0.0.js',

    // path to main executable 
    'http://localhost:3000//examples/headtag-capture/main.js',

    // detector function
    function (){
        var match = /webkit|msie\s10|(firefox)[\/\s](\d+)|3ds/i.exec(navigator.userAgent)
        var isCompatible;
        if (match) {
            if (match[1] && (match[1] === "firefox") && (+match[2] < 4)) {
                isCompatible = false;
            } else {
                isCompatible = true;
            }
        }
        var optedOut = /mobify-path=($|;)/.test(document.cookie);
        if (!isCompatible || optedOut) {
            return false;
        }
        return true;
    }
);
</script>