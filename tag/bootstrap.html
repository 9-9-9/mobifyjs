<script>
(function(window, document, mainUrl) {

window.Mobify = {points: [+new Date], tagVersion: [2, 0]};

// var isMobile = /ip(hone|od|ad)|android|blackberry.*applewebkit/i.test(navigator.userAgent)
//  , optedOut = /mobify-path=($|;)/.test(document.cookie);

//if (!isMobile || optedOut) {
//    return 
//}

// sj: TODO - Write logic to remove incompatable browsers

function request(url, callback) {
    httpRequest = new XMLHttpRequest();
    httpRequest.onreadystatechange = function() {
        if (httpRequest.readyState === 4) {
            if (httpRequest.status === 200) {
                callback(httpRequest.responseText);
            } else {
                alert('There was a problem with the request.');
            }
        }
    };
    httpRequest.open('GET', url);
    httpRequest.send();
}

document.write('<plaintext style="display:none">');


setTimeout(function() {
    window.capturing = true;

    var processLib = function(library) {
        // attach library to window for later use
        window.library = library;

        // load library
        eval(library);

        // load user code
        var main = document.createElement('script')
          , script = document.getElementsByTagName('script')[0];

        main.src = mainUrl;
        main.id = "mobify-js-main";
        script.parentNode.insertBefore(main, script);
    };

    request("http://cloud.dev:8000/static/mobifyjs/mobify.js", processLib);

});

// })(this, document, '{{ mobifyjsPath }}');
})(this, document, 'http://localhost:3000/examples/capture/main.js');
</script>
