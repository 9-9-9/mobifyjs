<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="qunit/qunit.css">
    <script src="qunit/qunit.js"></script>  
    <!-- <script src="qunit/junit.js"></script> -->
</head>
<body>
    <!-- 
    USAGE
    1. run the test server: node tests/server.js
    2. localtunnel 1337 (so combo can see the scripts)
    3. navigate to the localtunnel url
    -->


    <!-- QUNIT -->
    <h1 id="qunit-header">QUnit Test Suite</h1>  
    <h2 id="qunit-banner"></h2>  
    <div id="qunit-testrunner-toolbar"></div>  
    <h2 id="qunit-userAgent"></h2>  
    <ol id="qunit-tests"></ol>  

    <!-- FIXTURES -->
    <script src="../vendor/zepto.js"></script>
    <script>
        Mobify = window.Mobify || {};
        Mobify.$ = $
    </script>

    <script src="../api/combo-caching.js"></script>

    <!-- TESTS rehydrateCache-->
    <script>
    module('Mobify.combo cache');

    test('Mobify.combo.rehydrateCache', function() {
        Mobify.combo.clearCache();

        // Sixty Days in seconds
        var SIXTY_DAYS = 60 * 24 * 60 * 60;
        // Two weeks in seconds
        var TWO_WEEKS = 14 * 24 * 60 * 60;
        //five minutes in seconds
        var FIVE_MINUTES = 5 * 60;

        
        // Let's build a dehydrated cache by hand and test rehydration
        testMessage = "Hello, from the dehydrated cache."

        test_cache_contents = {
            'key1': {
                'msg': testMessage
            },
            'key2': {
                'msg': testMessage
            }
        }

        localStorage[Mobify.httpCaching.lsKey] = JSON.stringify(test_cache_contents);

        Mobify.combo.rehydrateCache();

        equal(testMessage, Mobify.combo.resources['key1']['msg']);
        equal(testMessage, Mobify.combo.resources['key2']['msg']);
    });
    </script>

    <script>
    asyncTest('Mobify.combo.dehydrateCache', function() {
        Mobify.combo.clearCache();

        Mobify.combo.resources['foo'] = 'bar';
        var resourcesJSON = JSON.stringify(Mobify.combo.resources);

        Mobify.combo.dehydrateCache();
        // Check asynchronosuly, since dehydrate won't store until after the next tick
        setTimeout(function() {
            equal(localStorage[Mobify.httpCaching.lsKey], resourcesJSON);
            start();
        }, 0);
    });
    </script>

</body>
</html>